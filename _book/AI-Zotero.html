<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AI驱动Zotero智慧文献集成平台 - 1&nbsp; 操作示例</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./file-fe-fQhUAzZa0hHekgRXwxPZIAjx.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./AI-Zotero.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">操作示例</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AI驱动Zotero智慧文献集成平台</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AI-Zotero.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">操作示例</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./file-fe-fQhUAzZa0hHekgRXwxPZIAjx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">文献解读报告</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">环境配置</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#第一步使用qwen检索相关文献" id="toc-第一步使用qwen检索相关文献" class="nav-link active" data-scroll-target="#第一步使用qwen检索相关文献"><span class="header-section-number">1.1</span> 第一步：使用Qwen检索相关文献</a></li>
  <li><a href="#第二步将检索到的文献上传到zotero进行文献管理" id="toc-第二步将检索到的文献上传到zotero进行文献管理" class="nav-link" data-scroll-target="#第二步将检索到的文献上传到zotero进行文献管理"><span class="header-section-number">1.2</span> 第二步：将检索到的文献上传到Zotero进行文献管理</a></li>
  <li><a href="#第三步将已保存到zotero文献上传到ai端" id="toc-第三步将已保存到zotero文献上传到ai端" class="nav-link" data-scroll-target="#第三步将已保存到zotero文献上传到ai端"><span class="header-section-number">1.3</span> 第三步:将已保存到Zotero文献上传到AI端</a></li>
  <li><a href="#第四步提供提示词给ai解读文献" id="toc-第四步提供提示词给ai解读文献" class="nav-link" data-scroll-target="#第四步提供提示词给ai解读文献"><span class="header-section-number">1.4</span> 第四步：提供提示词给AI解读文献</a></li>
  <li><a href="#调用api解析文件并将结果存为md文档" id="toc-调用api解析文件并将结果存为md文档" class="nav-link" data-scroll-target="#调用api解析文件并将结果存为md文档"><span class="header-section-number">1.5</span> 调用API解析文件并将结果存为md文档</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">操作示例</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="第一步使用qwen检索相关文献" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="第一步使用qwen检索相关文献"><span class="header-section-number">1.1</span> 第一步：使用Qwen检索相关文献</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-03-20T08:20:22.057909Z&quot;,&quot;start_time&quot;:&quot;2025-03-20T08:20:22.046970Z&quot;}">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取环境变量（env.yml）</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_env():</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"env.yml"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> yaml.safe_load(f)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载 API Key</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>env_config <span class="op">=</span> read_env()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>API_KEY <span class="op">=</span> env_config.get(<span class="st">"Bai_Lian_API_KEY"</span>, <span class="st">""</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置 OpenAI 认证（Base URL 直接硬编码）</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>openai.api_key <span class="op">=</span> API_KEY</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>openai.api_base <span class="op">=</span> <span class="st">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：fetch_crossref</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：调用 CrossRef API 根据查询条件获取文献数据</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 参数：</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   query      - 查询字符串（例如方向和关键词的组合）</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   year_range - 出版年份范围，格式如 "2018-2025"</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回值：一个包含文献信息的列表</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_crossref(query, year_range):</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.crossref.org/works"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"query"</span>: query,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"filter"</span>: <span class="ss">f"from-pub-date:</span><span class="sc">{</span>year_range<span class="sc">.</span>split(<span class="st">'-'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">,until-pub-date:</span><span class="sc">{</span>year_range<span class="sc">.</span>split(<span class="st">'-'</span>)[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"rows"</span>: <span class="dv">50</span>  <span class="co"># 获取50篇文献，可根据实际需要修改</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"User-Agent"</span>: <span class="st">"DocumentManager/1.0 (mailto:your_email@example.com)"</span>  <span class="co"># 建议替换为你自己的邮箱</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url, params<span class="op">=</span>params, headers<span class="op">=</span>headers)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json().get(<span class="st">'message'</span>, {}).get(<span class="st">'items'</span>, [])</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"CrossRef请求失败：</span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：read_config</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：从 config.yaml 文件中读取配置参数（方向、关键词、出版年份范围）</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回值：一个字典，包含配置信息</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_config():</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"config.yaml"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> yaml.safe_load(f)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：qwen_api_call</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：调用 Qwen API 生成对话回复（这里用于返回文献相关性评分）</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 参数：</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   prompt - 发送到模型的提示文本</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   model  - 使用的模型名称，默认使用 "qwen-max"</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回值：API 返回的文本（这里应为一个评分的数字字符串）</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> qwen_api_call(prompt, model<span class="op">=</span><span class="st">"qwen-max"</span>):</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        completion <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>model,</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>[</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You are a helpful assistant."</span>},</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.0</span>,  <span class="co"># 保证输出稳定</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            top_p<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">10</span>    <span class="co"># 输出长度，根据需要可调大</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> completion.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Qwen API调用失败："</span>, e)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：ai_filter_qwen</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：利用 Qwen API 对文献与设定方向的相关性进行评分，并判断是否超过阈值</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 参数：</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   item      - 单篇文献预处理后的数据（包含标题、摘要等）</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   direction - 给定的研究方向或主题</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   threshold - 评分阈值（默认0.6，&gt;=这个值则认为相关）</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回值：如果文献相关返回 True，否则返回 False</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ai_filter_qwen(item, direction, threshold<span class="op">=</span><span class="fl">0.6</span>):</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="ss">请判断以下文献是否与“</span><span class="sc">{</span>direction<span class="sc">}</span><span class="ss">”密切相关，并请仅返回一个0到1之间的评分（保留两位小数）。</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="ss">标题：</span><span class="sc">{</span>item<span class="sc">.</span>get(<span class="st">'title'</span>, <span class="st">'无标题'</span>)<span class="sc">}</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="ss">摘要：</span><span class="sc">{</span>item<span class="sc">.</span>get(<span class="st">'abstract'</span>, <span class="st">'无摘要'</span>)<span class="sc">}</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="ss">评分标准：</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="ss">0.00 表示完全不相关，1.00 表示高度相关。</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> qwen_api_call(prompt)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        score_str <span class="op">=</span> response.strip()</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> <span class="bu">float</span>(score_str)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"文献《</span><span class="sc">{</span>item[<span class="st">'title'</span>][:<span class="dv">30</span>]<span class="sc">}</span><span class="ss">...》评分：</span><span class="sc">{</span>score<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> score <span class="op">&gt;=</span> threshold</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"评分解析错误：</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：save_filtered_items</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：将过滤后的文献信息保存至指定文件（这里使用 YAML 格式）</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_filtered_items(filtered_items, filename<span class="op">=</span><span class="st">"filtered_items.yaml"</span>):</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">"w"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        yaml.safe_dump(filtered_items, f, allow_unicode<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"过滤后的文献信息已保存至 </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="co"># 主函数</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    config <span class="op">=</span> read_config()</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    direction <span class="op">=</span> config.get(<span class="st">"direction"</span>, <span class="st">""</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> <span class="st">" "</span>.join(config.get(<span class="st">"keywords"</span>, []))</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    publication_year <span class="op">=</span> config.get(<span class="st">"publication_year"</span>, <span class="st">""</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>direction<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>keywords<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> fetch_crossref(query, publication_year)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 预处理文献数据，提取关键字段</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    processed_items <span class="op">=</span> []</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> items:</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        processed <span class="op">=</span> {</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>            <span class="st">"title"</span>: item.get(<span class="st">"title"</span>, [<span class="st">""</span>])[<span class="dv">0</span>] <span class="cf">if</span> item.get(<span class="st">"title"</span>) <span class="cf">else</span> <span class="st">"无标题"</span>,</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>            <span class="st">"abstract"</span>: item.get(<span class="st">"abstract"</span>, <span class="st">"无摘要"</span>),</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>            <span class="st">"authors"</span>: item.get(<span class="st">"author"</span>, []),</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>            <span class="st">"date"</span>: item.get(<span class="st">"issued"</span>, {}).get(<span class="st">"date-parts"</span>, [[<span class="st">""</span>]])[<span class="dv">0</span>][<span class="dv">0</span>],</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>            <span class="st">"DOI"</span>: item.get(<span class="st">"DOI"</span>, <span class="st">""</span>)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        processed_items.append(processed)</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"初步获取到 </span><span class="sc">{</span><span class="bu">len</span>(processed_items)<span class="sc">}</span><span class="ss"> 篇文献。"</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 使用 Qwen API 对文献进行过滤，根据相关性评分判断是否通过</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    filtered_items <span class="op">=</span> []</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> processed_items:</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ai_filter_qwen(item, direction):</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            filtered_items.append(item)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"文献《</span><span class="sc">{</span>item[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">》通过Qwen过滤。"</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"文献《</span><span class="sc">{</span>item[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">》未通过Qwen过滤。"</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)  <span class="co"># 暂停1秒，防止请求过于频繁</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"经过Qwen过滤后，剩余文献数量：</span><span class="sc">{</span><span class="bu">len</span>(filtered_items)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 保存过滤后的文献信息到文件</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    save_filtered_items(filtered_items, filename<span class="op">=</span><span class="st">"filtered_items.yaml"</span>)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co"># 当脚本作为主程序执行时，调用 main() 函数</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>初步获取到 50 篇文献。
文献《基于在生物教学中激发学生学习兴趣的研究...》评分：0.0
文献《基于在生物教学中激发学生学习兴趣的研究》未通过Qwen过滤。
文献《基于深度学习的工程图像识别与分类研究...》评分：0.05
文献《基于深度学习的工程图像识别与分类研究》未通过Qwen过滤。
文献《CT-CPI: Deep Learning Model of...》评分：0.05
文献《CT-CPI: Deep Learning Model of Compound-Protein Interaction Based on Integrated CNN Module and Transformer》未通过Qwen过滤。
文献《基于深度学习的工程检测智能化创新研究...》评分：0.01
文献《基于深度学习的工程检测智能化创新研究》未通过Qwen过滤。
文献《Research Progress of Predictin...》评分：0.05
文献《Research Progress of Predicting Long Non-Coding RNA-MicroRNA Interaction Based on Deep Learning》未通过Qwen过滤。
文献《Practice Exploration of “Inter...》评分：0.0
文献《Practice Exploration of “Internet plus Deep Learning” Mixed Teaching System of Medical Physics》未通过Qwen过滤。
文献《基于深度学习的工业机器人运动控制算法优化研究...》评分：0.0
文献《基于深度学习的工业机器人运动控制算法优化研究》未通过Qwen过滤。
文献《MicroDIG: 基于自监督学习的大规模微生物组纵向数据有...》评分：0.85
文献《MicroDIG: 基于自监督学习的大规模微生物组纵向数据有向互作估计》通过Qwen过滤。
文献《基于机器学习和深度学习的抗菌肽预测研究进展...》评分：0.25
文献《基于机器学习和深度学习的抗菌肽预测研究进展》未通过Qwen过滤。
文献《基于ANSYS的土与深基坑地连墙相互作用研究...》评分：0.0
文献《基于ANSYS的土与深基坑地连墙相互作用研究》未通过Qwen过滤。
文献《基于机器学习和深度学习的蛋白质结构预测研究进展...》评分：0.25
文献《基于机器学习和深度学习的蛋白质结构预测研究进展》未通过Qwen过滤。
文献《尊重幼儿，多维互动，深度学习，共同成长——基于互动课程促发幼...》评分：0.0
文献《尊重幼儿，多维互动，深度学习，共同成长——基于互动课程促发幼儿深度学习的实践尝试》未通过Qwen过滤。
文献《Research on Predicting TCR and...》评分：0.0
文献《Research on Predicting TCR and Peptide Interaction Algorithms Based on Deep Learning》未通过Qwen过滤。
文献《基于批判性思维的农村中学道德与法治课堂深度学习策略...》评分：0.0
文献《基于批判性思维的农村中学道德与法治课堂深度学习策略》未通过Qwen过滤。
文献《基于生物信息学分析的骨肉瘤hub基因的识别与免疫机制的研究...》评分：0.0
文献《基于生物信息学分析的骨肉瘤hub基因的识别与免疫机制的研究》未通过Qwen过滤。
文献《Research Progress on Predictin...》评分：0.02
文献《Research Progress on Predicting Interaction between Long Noncoding RNA and Protein Based on Deep Learning》未通过Qwen过滤。
文献《基于深度学习的乡土地理教学调研——以山西省为例...》评分：0.0
文献《基于深度学习的乡土地理教学调研——以山西省为例》未通过Qwen过滤。
文献《Deep Learning: New Engine for ...》评分：0.25
文献《Deep Learning: New Engine for the Study of Material Microstructures and Physical Properties》未通过Qwen过滤。
文献《基于深度学习的器官芯片驱动设备运行状态监测方法研究...》评分：0.0
文献《基于深度学习的器官芯片驱动设备运行状态监测方法研究》未通过Qwen过滤。
文献《Molecular biological studies o...》评分：0.25
文献《Molecular biological studies on the interactions between bromoviruses and plants》未通过Qwen过滤。
文献《信息管理与信息系统中基于深度学习的知识图谱构建与应用研究...》评分：0.05
文献《信息管理与信息系统中基于深度学习的知识图谱构建与应用研究》未通过Qwen过滤。
文献《AI 与教学深度融合：提升小学科学课堂教学的互动性与学习效果...》评分：0.0
文献《AI 与教学深度融合：提升小学科学课堂教学的互动性与学习效果的研究与实践》未通过Qwen过滤。
文献《A Study on the Learning State ...》评分：0.0
文献《A Study on the Learning State of Classroom Students Based on Deep Learning》未通过Qwen过滤。
文献《Application of “Omics” on the ...》评分：0.65
文献《Application of “Omics” on the Study of Interaction between Endophyte and Plant》通过Qwen过滤。
文献《基于深度学习的网络安全威胁智能识别与防御研究...》评分：0.0
文献《基于深度学习的网络安全威胁智能识别与防御研究》未通过Qwen过滤。
文献《课堂有效师生互动对法语学习者学习效果实证研究...》评分：0.0
文献《课堂有效师生互动对法语学习者学习效果实证研究》未通过Qwen过滤。
文献《基于核心素养的初中生物实验教学创新路径研究...》评分：0.0
文献《基于核心素养的初中生物实验教学创新路径研究》未通过Qwen过滤。
文献《Research on Building Extractio...》评分：0.0
文献《Research on Building Extraction Method from Remote Sensing Images Based on Deep Learning》未通过Qwen过滤。
文献《语言与动作的神经网络耦合：基于EEG的研究...》评分：0.0
文献《语言与动作的神经网络耦合：基于EEG的研究》未通过Qwen过滤。
文献《“梳理·探究·训练教学模式”与“深度学习路线”的整合研究与实...》评分：0.0
文献《“梳理·探究·训练教学模式”与“深度学习路线”的整合研究与实践》未通过Qwen过滤。
文献《园林绿化植物的养护管理工作研究...》评分：0.02
文献《园林绿化植物的养护管理工作研究》未通过Qwen过滤。
文献《Research on Cell Segmentation ...》评分：0.15
文献《Research on Cell Segmentation Methods Based on Microfluidics and Deep Learning》未通过Qwen过滤。
文献《Research Progress on Predictin...》评分：0.05
文献《Research Progress on Predicting Interaction between Drugs Based on Graph Convolution Network》未通过Qwen过滤。
文献《基于问题导向的高中生物课堂互动策略研究...》评分：0.0
文献《基于问题导向的高中生物课堂互动策略研究》未通过Qwen过滤。
文献《构造微生物学：地球生物学研究的新理念...》评分：0.15
文献《构造微生物学：地球生物学研究的新理念》未通过Qwen过滤。
文献《Application Research on Practi...》评分：0.2
文献《Application Research on Practical Survival Problems Based on Deep Learning》未通过Qwen过滤。
文献《浅谈初中物理教学的学生学习物理兴趣培养...》评分：0.0
文献《浅谈初中物理教学的学生学习物理兴趣培养》未通过Qwen过滤。
文献《基于问题的学习模式在物理教学中的应用——以《探究杠杆的平衡条...》评分：0.0
文献《基于问题的学习模式在物理教学中的应用——以《探究杠杆的平衡条件》为例》未通过Qwen过滤。
文献《基于深度学习的智能图像识别系统研究...》评分：0.15
文献《基于深度学习的智能图像识别系统研究》未通过Qwen过滤。
文献《土壤肥力与农作物产量的关系研究...》评分：0.25
文献《土壤肥力与农作物产量的关系研究》未通过Qwen过滤。
文献《初中物理课堂学生参与式学习的研究...》评分：0.0
文献《初中物理课堂学生参与式学习的研究》未通过Qwen过滤。
文献《基于土地储备的土地管理研究...》评分：0.0
文献《基于土地储备的土地管理研究》未通过Qwen过滤。
文献《Research and Analysis of Textu...》评分：0.0
文献《Research and Analysis of Textual Multi-Emotion Based on Deep Learning》未通过Qwen过滤。
文献《Advances in Studies on the Int...》评分：0.45
文献《Advances in Studies on the Interaction between PGPR and Rhizobium》未通过Qwen过滤。
文献《农作物中微喷灌技术的应用...》评分：0.0
文献《农作物中微喷灌技术的应用》未通过Qwen过滤。
文献《基于深度学习理念下的初中语文活动课堂的策略研究...》评分：0.0
文献《基于深度学习理念下的初中语文活动课堂的策略研究》未通过Qwen过滤。
文献《基于深度学习的测绘图像识别与处理...》评分：0.05
文献《基于深度学习的测绘图像识别与处理》未通过Qwen过滤。
文献《基于物理启发式的深度学习方法对蛋白质三维的结构修复与扩展采样...》评分：0.1
文献《基于物理启发式的深度学习方法对蛋白质三维的结构修复与扩展采样》未通过Qwen过滤。
文献《食品微生物检验的方法与质量控制...》评分：0.0
文献《食品微生物检验的方法与质量控制》未通过Qwen过滤。
文献《Research on Obstacle Detection...》评分：0.0
文献《Research on Obstacle Detection for Intelligent Connected Autonomous Vehicles Based on Deep Learning》未通过Qwen过滤。
经过Qwen过滤后，剩余文献数量：2
过滤后的文献信息已保存至 filtered_items.yaml</code></pre>
</div>
</div>
</section>
<section id="第二步将检索到的文献上传到zotero进行文献管理" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="第二步将检索到的文献上传到zotero进行文献管理"><span class="header-section-number">1.2</span> 第二步：将检索到的文献上传到Zotero进行文献管理</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取环境变量（env.yml）</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_env():</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"env.yml"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> yaml.safe_load(f)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载 API Key 和 User ID</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>env_config <span class="op">=</span> read_env()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>USER_ID <span class="op">=</span> env_config.get(<span class="st">"Zotero_user_id"</span>, <span class="st">""</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>API_KEY <span class="op">=</span> env_config.get(<span class="st">"Zotero_API_KEY"</span>, <span class="st">""</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 构造用于上传文献的 Zotero API URL</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>ZOTERO_UPLOAD_URL <span class="op">=</span> <span class="ss">f"https://api.zotero.org/users/</span><span class="sc">{</span>USER_ID<span class="sc">}</span><span class="ss">/items"</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：load_filtered_items</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：从 YAML 文件中读取第一步筛选好的文献信息</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_filtered_items(filename<span class="op">=</span><span class="st">"filtered_items.yaml"</span>):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            items <span class="op">=</span> yaml.safe_load(f)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"成功读取 </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">}</span><span class="ss"> 篇筛选后的文献。"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> items</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"读取文件 </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> 时出错："</span>, e)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：convert_to_zotero_format</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：转换单个文献的信息为符合 Zotero API 要求的数据格式</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 示例中假定每篇文献包含 "title", "abstract", "authors", "date", "DOI" 字段，</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为 Zotero 项（如期刊论文）的格式。你可能需要补充更多必需字段。</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_to_zotero_format(item):</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 默认转换为期刊论文；实际上传时请确保数据包含 Zotero 要求的所有必要字段。</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    zotero_item <span class="op">=</span> {</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"itemType"</span>: <span class="st">"journalArticle"</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"title"</span>: item.get(<span class="st">"title"</span>, <span class="st">"无标题"</span>),</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"abstractNote"</span>: item.get(<span class="st">"abstract"</span>, <span class="st">""</span>),</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"creators"</span>: [],</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: <span class="bu">str</span>(item.get(<span class="st">"date"</span>, <span class="st">""</span>)),</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DOI"</span>: item.get(<span class="st">"DOI"</span>, <span class="st">""</span>)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 假设 "authors" 字段为一个列表，每个作者为字典，包含 "name" 或 "firstName"/"lastName" 信息</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> author <span class="kw">in</span> item.get(<span class="st">"authors"</span>, []):</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 如果有单独的 firstName 与 lastName</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"firstName"</span> <span class="kw">in</span> author <span class="kw">and</span> <span class="st">"lastName"</span> <span class="kw">in</span> author:</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>            creator <span class="op">=</span> {</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">"creatorType"</span>: <span class="st">"author"</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">"firstName"</span>: author[<span class="st">"firstName"</span>],</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">"lastName"</span>: author[<span class="st">"lastName"</span>]</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 若只有一个姓名字段，</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>            creator <span class="op">=</span> {<span class="st">"creatorType"</span>: <span class="st">"author"</span>, <span class="st">"lastName"</span>: author.get(<span class="st">"name"</span>, <span class="st">""</span>).strip()}</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        zotero_item[<span class="st">"creators"</span>].append(creator)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> zotero_item</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数：upload_items_to_zotero</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 作用：将转换后的文献数据上传到 Zotero</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 上传时，将文献数据以 JSON 数组传递给接口。请求头中通过 "Zotero-API-Key" 传递 API Key。</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upload_items_to_zotero(items):</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Zotero-API-Key"</span>: API_KEY,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Accept"</span>: <span class="st">"application/json"</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 将每篇文献转换为 Zotero 格式</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    zotero_items <span class="op">=</span> [convert_to_zotero_format(item) <span class="cf">for</span> item <span class="kw">in</span> items]</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 这里假定接口支持批量上传文档。根据 Zotero API，不同接口可能要求的请求体结构略有不同，</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 有时需要逐条 POST。请根据实际文档修改。</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> json.dumps(zotero_items, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(ZOTERO_UPLOAD_URL, headers<span class="op">=</span>headers, data<span class="op">=</span>payload)</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response.status_code <span class="kw">in</span> (<span class="dv">200</span>, <span class="dv">201</span>):</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"文献上传成功！"</span>)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                resp_json <span class="op">=</span> response.json()</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"服务器返回的信息："</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(json.dumps(resp_json, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> err:</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"解析服务器返回数据时出错："</span>, err)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"上传失败，状态码: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"响应内容："</span>, response.text)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"上传过程中出现错误："</span>, e)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 主函数</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> load_filtered_items(<span class="st">"filtered_items.yaml"</span>)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> items:</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"开始上传文献到 Zotero ..."</span>)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>        upload_items_to_zotero(items)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"没有读取到可上传的文献。"</span>)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>成功读取 2 篇筛选后的文献。
开始上传文献到 Zotero ...
文献上传成功！
服务器返回的信息：
{
  "successful": {
    "0": {
      "key": "I2QNRAH8",
      "version": 1092,
      "library": {
        "type": "user",
        "id": 11510297,
        "name": "ZhangRui218",
        "links": {
          "alternate": {
            "href": "https://www.zotero.org/zhangrui218",
            "type": "text/html"
          }
        }
      },
      "links": {
        "self": {
          "href": "https://api.zotero.org/users/11510297/items/I2QNRAH8",
          "type": "application/json"
        },
        "alternate": {
          "href": "https://www.zotero.org/zhangrui218/items/I2QNRAH8",
          "type": "text/html"
        }
      },
      "meta": {
        "parsedDate": "2025",
        "numChildren": 0
      },
      "data": {
        "key": "I2QNRAH8",
        "version": 1092,
        "itemType": "journalArticle",
        "title": "MicroDIG: 基于自监督学习的大规模微生物组纵向数据有向互作估计",
        "creators": [],
        "abstractNote": "",
        "publicationTitle": "",
        "volume": "",
        "issue": "",
        "pages": "",
        "date": "2025",
        "series": "",
        "seriesTitle": "",
        "seriesText": "",
        "journalAbbreviation": "",
        "language": "",
        "DOI": "10.1360/ssm-2024-0293",
        "ISSN": "",
        "shortTitle": "",
        "url": "",
        "accessDate": "",
        "archive": "",
        "archiveLocation": "",
        "libraryCatalog": "",
        "callNumber": "",
        "rights": "",
        "extra": "",
        "tags": [],
        "collections": [],
        "relations": {},
        "dateAdded": "2025-03-20T14:23:59Z",
        "dateModified": "2025-03-20T14:23:59Z"
      }
    },
    "1": {
      "key": "JG9RNPJQ",
      "version": 1092,
      "library": {
        "type": "user",
        "id": 11510297,
        "name": "ZhangRui218",
        "links": {
          "alternate": {
            "href": "https://www.zotero.org/zhangrui218",
            "type": "text/html"
          }
        }
      },
      "links": {
        "self": {
          "href": "https://api.zotero.org/users/11510297/items/JG9RNPJQ",
          "type": "application/json"
        },
        "alternate": {
          "href": "https://www.zotero.org/zhangrui218/items/JG9RNPJQ",
          "type": "text/html"
        }
      },
      "meta": {
        "parsedDate": "2019",
        "numChildren": 0
      },
      "data": {
        "key": "JG9RNPJQ",
        "version": 1092,
        "itemType": "journalArticle",
        "title": "Application of “Omics” on the Study of Interaction between Endophyte and Plant",
        "creators": [],
        "abstractNote": "",
        "publicationTitle": "",
        "volume": "",
        "issue": "",
        "pages": "",
        "date": "2019",
        "series": "",
        "seriesTitle": "",
        "seriesText": "",
        "journalAbbreviation": "",
        "language": "",
        "DOI": "10.12677/amb.2019.82007",
        "ISSN": "",
        "shortTitle": "",
        "url": "",
        "accessDate": "",
        "archive": "",
        "archiveLocation": "",
        "libraryCatalog": "",
        "callNumber": "",
        "rights": "",
        "extra": "",
        "tags": [],
        "collections": [],
        "relations": {},
        "dateAdded": "2025-03-20T14:23:59Z",
        "dateModified": "2025-03-20T14:23:59Z"
      }
    }
  },
  "success": {
    "0": "I2QNRAH8",
    "1": "JG9RNPJQ"
  },
  "unchanged": {},
  "failed": {}
}</code></pre>
</div>
</div>
</section>
<section id="第三步将已保存到zotero文献上传到ai端" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="第三步将已保存到zotero文献上传到ai端"><span class="header-section-number">1.3</span> 第三步:将已保存到Zotero文献上传到AI端</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2025-03-21T07:11:34.787939Z&quot;,&quot;start_time&quot;:&quot;2025-03-21T07:11:33.995494Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取 env.yml 文件</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"env.yml"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    env_config <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取 API Key 和存储路径</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>Bai_Lian_API_KEY <span class="op">=</span> env_config.get(<span class="st">"Bai_Lian_API_KEY"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>Zotero_Storage <span class="op">=</span> env_config.get(<span class="st">"Zotero_Storage"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 确保 API Key 存在</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> Bai_Lian_API_KEY:</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API Key 未正确读取，请检查 env.yml 文件！"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 确保 Zotero_Storage 目录存在</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(Zotero_Storage):</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Zotero_Storage 路径 </span><span class="sc">{</span>Zotero_Storage<span class="sc">}</span><span class="ss"> 不存在！"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取所有 PDF 文件的路径</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>pdf_files <span class="op">=</span> [</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(Zotero_Storage)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files <span class="cf">if</span> <span class="bu">file</span>.lower().endswith(<span class="st">".pdf"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置 API 客户端</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>Bai_Lian_API_KEY,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 上传 PDF 文件并返回 file_id 列表</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upload_pdfs(pdf_files):</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    uploaded_files <span class="op">=</span> []</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pdf <span class="kw">in</span> pdf_files:</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            file_object <span class="op">=</span> client.files.create(<span class="bu">file</span><span class="op">=</span>Path(pdf), purpose<span class="op">=</span><span class="st">"file-extract"</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            uploaded_files.append(file_object.<span class="bu">id</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"成功上传：</span><span class="sc">{</span>pdf<span class="sc">}</span><span class="ss">，文件 ID：</span><span class="sc">{</span>file_object<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"上传失败：</span><span class="sc">{</span>pdf<span class="sc">}</span><span class="ss">，错误：</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> uploaded_files  <span class="co"># 直接返回 file_id 列表</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 直接调用并获取 file_id 列表</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>file_ids <span class="op">=</span> upload_pdfs(pdf_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>上传失败：./storage\A92TN94E\2019 - Application of “omics” on the study of interaction between endophyte and plant.pdf，错误：Request timed out.
成功上传：./storage\IECRI74X\2025 - MicroDIG 基于自监督学习的大规模微生物组纵向数据有向互作估计.pdf，文件 ID：file-fe-fQhUAzZa0hHekgRXwxPZIAjx</code></pre>
</div>
</div>
</section>
<section id="第四步提供提示词给ai解读文献" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="第四步提供提示词给ai解读文献"><span class="header-section-number">1.4</span> 第四步：提供提示词给AI解读文献</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提示词模板</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>PROMPT_TEMPLATE <span class="op">=</span> <span class="st">"""请按照以下步骤对英文文献进行深入解读和分析，确保结果逻辑清晰、内容全面：</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st"># 文献解读报告 </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">## 提取文章标题</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">### 基本信息提取</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">提取作者、发表年份、期刊名称等关键信息。</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">### 研究背景与目的</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">总结文献的研究背景，说明研究所解决的问题或提出的假设。</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">明确指出作者的研究目的和研究动机。</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st">### 研究方法</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="st">描述作者采用的研究方法（如实验、调查、建模、定量/定性分析等）。</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="st">解释数据来源、采集方式以及实验设计或分析框架。</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="st">分析所选方法的优势和可能存在的局限性。</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">### 主要发现与结果</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="st">概述文章的核心发现和关键数据。</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="st">对图表、统计数据和实验结果进行总结和分析。</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="st">强调研究结果对原始问题的解答和新发现。</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="st">### 讨论与结论</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="st">分析作者如何讨论结果及其对研究领域的影响。</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="st">总结文章的结论，并指出研究局限性、未解决的问题或作者提出的未来研究方向。</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="st">### 创新点与贡献</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="st">指出文献在理论、方法或实践方面的创新与独特贡献。</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="st">讨论该研究如何推动领域的发展，及其实际应用意义。</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="st">### 个人评价与启示</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="st">提出对文献整体质量、方法合理性和结果可信度的评价。</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="st">指出文献中的不足或存在争议之处。</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="st">给出自己对相关领域未来研究的建议和启示。</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="st">请确保在解读过程中：</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="st">语言表达准确、逻辑清晰；</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="st">分析内容既关注整体框架也注意细节；</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="st">引用和解释关键概念和数据时要做到充分且有条理。</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="st">注意：在输出列表的时候，需要再列表头与列表项之间加入两个空行（换行符），否则Quarto渲染时候会出错。</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="调用api解析文件并将结果存为md文档" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="调用api解析文件并将结果存为md文档"><span class="header-section-number">1.5</span> 调用API解析文件并将结果存为md文档</h2>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 初始化 OpenAI 客户端</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>Bai_Lian_API_KEY,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_pdfs(file_ids):</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""使用 API 解析所有已上传的 PDF，并返回解析内容"""</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> file_ids:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"未找到任何 file_id，无法解析！"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    parsed_results <span class="op">=</span> {}  <span class="co"># 存储 {file_id: full_content} 对应关系</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_id <span class="kw">in</span> file_ids:</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">正在解析文件 ID：</span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"qwen-long"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="ss">f"fileid://</span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">"</span>},</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">'role'</span>: <span class="st">'user'</span>, <span class="st">'content'</span>: PROMPT_TEMPLATE},</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 访问 message.content 获取结果</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            full_content <span class="op">=</span> completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">解析结果："</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(full_content)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 存入字典</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            parsed_results[file_id] <span class="op">=</span> full_content</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"解析失败：文件 ID </span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">，错误：</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parsed_results  <span class="co"># 返回所有解析结果</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_markdown(parsed_results):</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""将解析结果直接保存到当前工作目录，每个 PDF 解析结果单独存为一个 Markdown 文件"""</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    current_directory <span class="op">=</span> os.getcwd()  <span class="co"># 获取当前工作目录</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> file_id, content <span class="kw">in</span> parsed_results.items():</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        md_filename <span class="op">=</span> os.path.join(current_directory, <span class="ss">f"</span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">.md"</span>)  <span class="co"># 直接保存到当前目录</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(md_filename, <span class="st">"w"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>            f.write(content)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"✅ 解析内容已保存: </span><span class="sc">{</span>md_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co"># **执行解析并保存**</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>parsed_results <span class="op">=</span> parse_pdfs(file_ids)  <span class="co"># 解析 PDF</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>save_to_markdown(parsed_results)  <span class="co"># 保存 Markdown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
正在解析文件 ID：file-fe-fQhUAzZa0hHekgRXwxPZIAjx...

解析结果：
## 文章标题

MicroDIG: estimating directed interactions in large-scale microbiome longitudinal data based on self-supervised learning


### 基本信息提取

  Author(s):
  - Yaoyang Yu
  - Wenhao Zhang
  - Fengzhu Sun
  - Ying Wang
  
  Publication Year:
  - 2025
  
  Journal Name:
  - SCIENTIA SINICA Mathematica


### 研究背景与目的

  #### 研究背景
  微生物群落内的物种通过复杂的作用关系互相影响、相互依存，维持动态平衡。探索微生物群落的物种作用，对理解群落功能和机理十分重要。传统方法如湿实验培养微生物和基于相关性统计的方法（如Pearson和Spearman）在估计微生物群落中物种的作用关系时存在诸多限制，如时间成本高、假阳性率高、缺乏时间信息等。随着高通量测序技术和自监督学习的发展，为解决这些问题提供了新的思路。

  #### 研究目的
  本研究旨在开发一种基于自监督学习的框架MicroDIG（Microbiome Directed Interaction on GLV），利用微生物群落的纵向时序物种丰度数据，估计并校验大规模微生物群落内物种间的有向作用关系。该框架旨在克服现有方法的局限性，提供一种无需标准答案训练数据、具有清晰可解释性和灵活可拓展性的解决方案。


### 研究方法

  #### 方法描述
  MicroDIG采用自监督学习框架，结合数学机理（Generalized Lotka-Volterra, GLV方程）和神经网络（自编码器），估计并校验微生物群落内物种间的有向作用关系。具体步骤如下：

  1. **自监督数据增强**：基于GLV方程生成大量具有标准有向作用强度标签的配对OTU时序丰度模拟数据。
  2. **有向作用关系估计**：通过自编码器神经网络从增强训练数据中学习物种间的有向作用强度。
  3. **有效性校验**：通过仿真生成估计值为真/假时的两类p值分布，基于极大似然估计校验有向作用强度估计值的真/假，降低假阳性率。

  #### 数据来源与采集方式
  数据来源包括多角度多层次的仿真数据及人类肠道微生物群落的真实数据。仿真数据通过第三方工具miaSim生成，真实数据来自健康女性受试者在六个月内对肠道（粪便）进行取样测序得到的共计131个时间点的肠道微生物组时序丰度数据。

  #### 方法优势与局限性
  **优势**：
  - 不需要标准答案的训练数据，适用于大规模微生物群落。
  - 具有清晰的可解释性和灵活的可拓展性。
  - 有效降低估计结果的假阳性率，准确识别物种间的作用方向。

  **局限性**：
  - 目前仅限于两个物种间的有向作用关系建模分析，无法处理更复杂的多物种共同作用关系。
  - 忽略了外部因素（如宿主健康状态、环境变化等）对微生物群落的影响。


### 主要发现与结果

  #### 核心发现
  - MicroDIG在28个模拟微生物群落丰度数据集上的表现优于五类基准方法，特别是在大规模群落中表现出色。
  - MicroDIG能有效降低估计结果中的假阳性，准确识别物种间的作用方向，去除作用关系传递造成的假阳性。
  - MicroDIG在不同群落规模和不同采样时间点个数的情况下均表现出良好的性能。
  - 在真实人类肠道微生物组数据中，MicroDIG成功揭示了优势物种间的有向作用关系，结果与现有研究高度一致。

  #### 结果分析
  - 图5展示了MicroDIG在不同物种作用模式下的估计性能，R²值接近0.99，表明其估计结果具有极高的拟合度。
  - 图6和图7比较了MicroDIG与其他基准方法在不同群落规模下的性能，MicroDIG在所有规模下均表现出最佳效果。
  - 图8显示了MicroDIG在不同采样时间点个数下的性能变化，表明其性能随采样点的增多而提升。
  - 图9和图10验证了MicroDIG的有效性校验模块在去除假阳性方面的有效性，真阴性识别率高于85%。
  - 图11展示了MicroDIG在识别物种关联方向上的准确性，能准确保留较强作用关系，删除微弱作用关系。


### 讨论与结论

  #### 结果讨论
  作者详细讨论了MicroDIG在估计物种间有向作用关系上的优势，特别是其在大规模群落中的适用性和准确性。通过与五类基准方法的比较，MicroDIG在不同群落规模和不同采样时间点个数的情况下均表现出色，验证了其在实际应用场景中的实用性和准确性。

  #### 结论
  MicroDIG通过自监督学习框架，结合数学机理和智能学习，成功估计并校验了大规模微生物群落内物种间的有向作用关系。该框架具有无需标准答案训练数据、清晰可解释性和灵活可拓展性的特点，适用于大规模复杂微生物群落的真实场景中更加精细的互作关系探索。

  #### 局限性与未来研究方向
  尽管MicroDIG展现了出色的性能，但其设计思路仍局限于两个物种间的有向作用关系建模分析，无法处理更复杂的多物种共同作用关系。此外，真实环境中的微生物群落通常更加复杂和多元化，MicroDIG在处理外部因素影响方面还有待改进。未来研究可以考虑引入更有效的深度学习网络架构，如图网络结构、Transformer或LSTM等，以提升有向作用关系识别的能力。


### 创新点与贡献

  #### 理论与方法创新
  - 提出了基于自监督学习的框架MicroDIG，结合数学机理（GLV方程）和神经网络（自编码器），实现了无需标准答案训练数据的有向作用关系估计。
  - 设计了严格的校验流程，确保分析结果的可靠性，有效降低假阳性率。
  - 提出了自监督数据增强策略，生成大量自带有向作用关系标签的训练数据，提高了模型的泛化能力。

  #### 实践意义
  - MicroDIG在实际应用场景中能够高效且准确地揭示微生物群落中的作用关系，为微生物生态学研究提供了新的工具和方法。
  - 该框架具有灵活的可拓展性，可以应用于其他领域的动力学研究，如蛋白质组学和代谢组学等。


### 个人评价与启示

  #### 整体质量评价
  本文在理论和方法上具有较高的创新性，研究设计严谨，实验结果可靠。通过与五类基准方法的比较，验证了MicroDIG在不同群落规模和不同采样时间点个数下的优越性能，展示了其在实际应用场景中的实用性和准确性。

  #### 方法合理性评价
  MicroDIG采用自监督学习框架，结合数学机理和神经网络，解决了现有方法在估计微生物群落中物种作用关系时存在的局限性。该方法在理论上具有较强的逻辑性和可行性，但在处理更复杂的多物种共同作用关系和外部因素影响方面还有待进一步改进。

  #### 结果可信度评价
  本文通过多角度多层次的仿真数据和真实数据进行了大量的实验分析，验证了MicroDIG的性能和可靠性。实验结果表明，MicroDIG在不同群落规模和不同采样时间点个数的情况下均表现出色，具有较高的可信度。

  #### 未来研究建议
  - 进一步扩展MicroDIG框架，使其能够处理更复杂的多物种共同作用关系。
  - 引入更有效的深度学习网络架构，如图网络结构、Transformer或LSTM等，以提升有向作用关系识别的能力。
  - 考虑外部因素（如宿主健康状态、环境变化等）对微生物群落的影响，提高模型的预测精度。
  - 探索MicroDIG在其他领域的应用，如蛋白质组学和代谢组学等，推动相关领域的发展。
✅ 解析内容已保存: d:\AAAAA\323ddl\323ddl\Quarto\AI-paper\file-fe-fQhUAzZa0hHekgRXwxPZIAjx.md</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">前言</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./file-fe-fQhUAzZa0hHekgRXwxPZIAjx.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">文献解读报告</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>